<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="owc-core-i18n">
  <template></template>
  <script>
    class OwcCoreI18n extends Polymer.Element {
      static get is() { return 'owc-core-i18n'; }
      static get properties() {
        return {
          currentLanguage: {
            type: String,
            value: 'en' //Application language
          },
          dictionaries: { //All dictionaries
            type: Object,
            value: {}
          }
        };
      }

      ready() {
        super.ready();
        HTMLElement.prototype.i18n = function (termToTranslate) {//Prototype i18n
          return this._ctx.i18n.translate(termToTranslate, this._ctx.i18n.currentLanguage)
        }

        //Dictionaries terms as Json object
        var json = {
          "Attribute": {
            "it": "Valore",
            "es": "Atributo"
          },
          "list": {
            "it": "lista",
            "es": "cat치logo"
          },
          "loginLabel": {
            "en": "login",
            "it": "accedi",
            "es": "acceso"
          },
          "password": {
            "it": "parola chiave",
            "es": "contrase침a "
          },
          "username": {
            "it": "nome utente"
          },
          "Welcome": {
            "en": "Hello",
            "it": "Benvenuto",
            "es": "Bienvenida"
          },
          "wrongLogin": {
            "en": "The user name and password you entered did not match.",
            "it": "Il nome utente e la password che hai inserito non corrispondono.",
            "es": "El nombre de usuario y la contrase침a que ingres칩 no coinciden. "
          }
        }
        this.append(json); //Add json to dictionaries
      }

      /**
      *   Append a json object to all dictionaries specified in json data
      *
      * @param jsonData: example to append to dictionaries
      * key: keyTerm value 
      */
      append(jsonData) {
        var self = this;
        Object.keys(jsonData).forEach(function (key) {
          Object.keys(jsonData[key]).forEach(function (language) {
            self.appendTerm(language, key, jsonData[key][language]); //Append the single term
          });
        });
      }

      /**
      *   Append a single term in json format to a given dictionary
      *
      * @param language: language to append json to. if language is not present ill be created a new one
      * @param keyTerm : key value. 
      * @param val : value
      */
      appendTerm(language, keyTerm, val) {
        if (this.dictionaries[language] == undefined) this.dictionaries[language] = {}; //If dictionary doesnt exists, create it      
        this.dictionaries[language][keyTerm] = val; //Append new term 
      }

      /**
       *  Returns the corresponding translations if it finds one, otherwise returns the input value, using currentLanguage of i18n Component
       *
       * @param {?Object} newValue: the new value of public Property
       * @return {String} if a translation is present for the current language return the proper translations, otherwise returns
       */
      translate(keyTerm, language) {
        if (this.dictionaries[language] == undefined) return keyTerm; //if looking for a non existing language, still returns the value
        return this.dictionaries[language][keyTerm] == undefined ? keyTerm : this.dictionaries[language][keyTerm];
      }
    }
    window.customElements.define(OwcCoreI18n.is, OwcCoreI18n);
  </script>
</dom-module>