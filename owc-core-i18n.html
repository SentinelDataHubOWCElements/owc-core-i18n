<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="owc-core-i18n">
  <template>
    <style>
      :host {
        display: block;
      }

      .container {
        width: 200px;
      }
    </style>
    <div class="container">
      <h3>Hello [[componentName]]!</h3>

      <!-- test button -->
      <button on-click="append">Multiple Append</button>
      <button on-click="translate">test translate</button>
      <button on-click="appendDynamic">append Dynamically</button>
      <button on-click="logDictionary">LOG DICTIONARY</button>

    </div>
  </template>

  <script>
    /**
     * `owc-core-i18n`
     * i18n manager component
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class OwcCoreI18n extends Polymer.Element {
      static get is() {
        return 'owc-core-i18n';
      }
      static get properties() {
        return {
          componentName: {
            type: String,
            value: 'owc-core-i18n'
          },
          currentLanguage: {
            type: String,
            value: 'en' //default language
          },
          dictionaries: {
            type: Object,
            value: {}
          },
          exampleData: {
            type: Object,
            value: {
              "welcome":
              {
                "en": "Hello",
                "it": "Benvenuto"
              },
              "logout":
              {
                "it": "esci",
                "es": "logout"
              },
              "cat":
              {
                "it": "gatto",
                "fr": "chat"
              },
            }
          }
        };
      }

      constructor() {
        super();
      }

      ready() {
        super.ready();
        var self = this;
        self.appendTerm('it', 'hi', 'ciao'); //Example default append
      }

      /**
      *   Append a json object to dictionaries
      *
      * @param example: data to append to dictionaries
      */
      append(example) {
        var self = this;
        example = this.exampleData;
        var data = example;

        Object.keys(data).forEach(function (key) {
          Object.keys(data[key]).forEach(function (language) {
            var val = data[key][language];

            //Append the single term
            console.log('APPEND: Language: ', language, 'key is ', key, 'val is ', val);
            self.appendTerm(language, key, val);
          });
        });
      }

      logDictionary() {
        var self = this;
        console.log(self.dictionaries);
      }

      /**
      *   Append a json object to a given dictionary
      *
      * @param language: language to append json to. if language is not present ill be created a new one
      * @param k : key value. NOTE: it will be converted to the string param
      * @param val : value
      */
      appendTerm(language, k, val) {
        var self = this;
        var dict = self.dictionaries;

        if (dict[language] == undefined) { dict[language] = {}; } //If dictionary doesnt exists, create it
        dict[language][k] = val; //Append new term 
      }

      /**
       *   Translate a string
       *
       * @param {?Object} newValue: the new value of public Property
       * @return {String} translated string
       */
      translate(keyz, language) {
        var self = this;
        var languageDictionary = self.dictionaries[language];

        if (languageDictionary == undefined) { //if looking for a non existing language, throws an error but still returns the value
          return keyz;
        }

        //Return the corresponding translations if it finds one, otherwise returns the input value
        return languageDictionary[keyz] == undefined ? keyz : languageDictionary[keyz];
      }

      /**
      *   Set current language
      *
      * @param {String} newValue: language to set
      */
      setCurrentLanguage(newValue) {
        var self = this;
        this.currentLanguage = lang
      }
    }

    window.customElements.define(OwcCoreI18n.is, OwcCoreI18n);
  </script>
</dom-module>